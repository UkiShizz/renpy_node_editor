# RenPy Node Editor

Десктопный редактор для создания Ren'Py скриптов через визуальный граф узлов. Вместо ручного написания кода — просто расставляйте блоки (диалоги, меню, переходы) и соединяйте их линиями.

## Основные возможности

- **Визуальный редактор сцен**: создавайте логику игры как граф с узлами (блоками) и соединениями
- **Разнообразные типы блоков**: SAY, MENU, IF, JUMP, CALL, PAUSE, TRANSITION, SOUND, MUSIC, SET_VAR, LABEL
- **Редактор параметров**: интерактивное редактирование параметров блоков прямо в интерфейсе
- **Генерация кода**: автоматическое преобразование графа в готовый script.rpy
- **Запуск в Ren'Py**: сразу запустите созданный проект через Ren'Py SDK
- **Сохранение проектов**: экспортируйте и импортируйте проекты в формате JSON

## Структура проекта

```
renpy_node_editor/
├── src/
│   └── renpy_node_editor/
│       ├── core/           # Модели данных (Block, Scene, Project)
│       ├── runner/         # Интеграция с Ren'Py SDK
│       └── ui/             # Графический интерфейс
│           ├── node_graph/ # Визуальное представление графа
│           └── block_*.py  # Палитра и редактор блоков
├── configs/                # Конфигурация типов блоков
└── tests/                  # Тесты
```

## Быстрый старт

### Требования

- Python 3.8+
- PySide6
- Ren'Py SDK (для запуска созданных проектов)

### Установка

```bash
# Клонируйте репозиторий
git clone https://github.com/UkiShizz/renpy_node_editor.git
cd renpy_node_editor

# Создайте виртуальное окружение
python -m venv .venv

# Активируйте окружение
# Windows:
.\venv\Scripts\activate
# Linux/macOS:
source venv/bin/activate

# Установите зависимости
pip install -r requirements.txt
```

### Запуск

```bash
python -m renpy_node_editor.ui.main_window
```

## Настройка Ren'Py SDK

Эдитор не включает сам Ren'Py, поэтому вам нужно установить SDK отдельно.

1. Скачайте [Ren'Py SDK](https://www.renpy.org/) и распакуйте в удобное место
2. По умолчанию редактор ищет SDK здесь:
   - **Windows**: `C:\RenPy\renpy-8.3.7`
   - **Linux**: `/opt/renpy/renpy-8.3.7`

3. Если у вас другой путь, измените переменную `default_sdk_root()` в `runner/renpy_env.py`

## Использование

### Создание проекта

1. Нажмите "Новый проект" и выберите папку
2. На левой панели будет пусто — это канвас для вашей сцены
3. Справа видна палитра блоков — перетащите нужный блок на канвас

### Редактирование блоков

1. Кликните на блок в сцене
2. На правой панели откроется редактор параметров
3. Заполните нужные значения (текст, условие, переход и т.д.)
4. Нажмите "Save Properties"

### Соединение блоков

1. Левый клик и перетащите от выходного порта одного блока
2. Отпустите на входном порту другого блока
3. Граф обновится и будет готов к генерации

### Генерация и запуск

1. Нажмите "Сгенерировать код" — увидите preview скрипта
2. Нажмите "Запустить в Ren'Py" — проект откроется в Ren'Py

## Типы блоков

| Блок | Описание | Параметры |
|------|---------|----------|
| **SAY** | Диалог персонажа | character, text |
| **MENU** | Меню выбора | prompt, options |
| **IF** | Условное ветвление | condition |
| **JUMP** | Прыжок на метку | label |
| **CALL** | Вызов подсцены | label |
| **PAUSE** | Пауза в сценарии | duration |
| **TRANSITION** | Переход между сценами | transition, duration |
| **SOUND** | Воспроизведение звука | sound_file |
| **MUSIC** | Музыкальное сопровождение | music_file, loop |
| **SET_VAR** | Установка переменной | variable, value |
| **LABEL** | Метка для переходов | label_name |

## Разработка

### Запуск тестов

```bash
python -m pytest tests/
```

### Добавление новых типов блоков

1. Отредактируйте `configs/blocks_schema.json` — добавьте новый тип
2. Обновите `BlockType` в `core/model.py`
3. Добавьте UI логику в `ui/block_properties_panel.py`

## Архитектура

- **Model** (`core/model.py`): структуры данных для проекта, сцены, блоков
- **Controller** (`app_controller.py`): бизнес-логика для работы с проектами
- **View** (`ui/`): все UI компоненты на PySide6
- **Runner** (`runner/`): интеграция с Ren'Py для генерации и запуска

## Лицензия

MIT

## Связь

Если нашли баги или есть идеи — создавайте issues на GitHub.
